#!/usr/bin/env bash
# Make localhost -> 127.0.0.2 and facebook.com -> 8.8.8.8 by rewriting /etc/hosts in place (no inode rename)

set -euo pipefail

hosts_file="/etc/hosts"

# Build filtered content without the entries we control
# (drop any localhost mapping on 127.0.0.1/127.0.0.2 and any facebook.com line)
filtered="$(awk '
  !($2=="localhost" && ($1=="127.0.0.1" || $1=="127.0.0.2")) &&
  !($2=="facebook.com")
' "$hosts_file")"

# Rewrite file in-place via redirection (no sed -i, no mv)
{
  echo '8.8.8.8 facebook.com'
  echo '127.0.0.2 localhost'
  printf '%s\n' "$filtered"
} > "$hosts_file"
