#!/usr/bin/env bash
# Make localhost -> 127.0.0.2 and facebook.com -> 8.8.8.8 by rewriting /etc/hosts without renaming it

set -euo pipefail

hosts_file="/etc/hosts"

# Capture the existing content with the two mappings removed,
# then write new header + old content back via tee (no rename).
filtered="$(awk '!($1=="127.0.0.2" && $2=="localhost") \
                && !($1=="127.0.0.1" && $2=="localhost") \
                && !($1=="8.8.8.8" && $2=="facebook.com") { print }' "$hosts_file")"

{
  echo '8.8.8.8 facebook.com'
  echo '127.0.0.2 localhost'
  printf '%s\n' "$filtered"
} | tee "$hosts_file" >/dev/null
